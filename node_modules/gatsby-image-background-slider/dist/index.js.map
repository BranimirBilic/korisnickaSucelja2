{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport Img from \"gatsby-image\"\r\n\r\n/**\r\n * @param {object} props Component props\r\n * @param {object} props.callbacks interface for callback functions (pass this to Pagination, if used)\r\n * @param {(newIndex:number) => void} props.callbacks.atIndex sets background to specified index\r\n * @param {(prevIndex: number, newIndex: number) => void} props.callbacks.onChange user-provided callback fired when background image changes\r\n * @param {Function} props.callbacks.next sets background to the next one\r\n * @param {Function} props.callbacks.prev sets background to the previous one \r\n * @param {string[]} props.images list of specified image file names to set order\r\n * @param {number} [props.duration=5] duration background is shown for\r\n * @param {number} [props.transition=2] length of transition\r\n * @param {object.isRequired} props.query result of GraphQL query for images\r\n * @param {JSXElement[]} props.children subtitles/captions in sync for respective background images;\r\n * (<React.Fragment/> to skip over one)\r\n * @param {Array} props.gatsbyImageProps remaining props spread onto Img elements\r\n * @param {number} [props.initDelay=5] initial delay before first transition\r\n */\r\nconst BackgroundSlider = ({callbacks, images, duration, transition, initDelay, query, children, ...gatsbyImageProps}) => {\t\r\n\tlet nodes = [];\r\n\tlet bgRefs = [];\r\n\tlet subRefs = [];\t\r\n\tlet bgWrappers = [];\r\n\tlet subWrappers = [];\r\n\tconst {style, ...imageProps} = gatsbyImageProps;    \r\n\r\n\tnodes.safePush = function(data){\r\n\t\tif(data){\r\n\t\t\treturn this.push(data);\r\n\t\t}else{\r\n\t\t\treturn this.length;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(images){\r\n\t\tfor(let image of images){\r\n\t\t\tnodes.safePush(\r\n\t\t\t\tquery.backgrounds.nodes.find(\r\n\t\t\t\t\tnode => node.relativePath === image\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t}\r\n\t}else{\r\n\t\tnodes = query.backgrounds.nodes;\r\n\t}\r\n\t\r\n\tconst imgs = nodes.map(\r\n\t\t(data, index)=>{\t\t\t\r\n\t\t\tconst backgroundStyle = {\r\n\t\t\t\tposition:\"absolute\", \r\n\t\t\t\tzIndex: -10,\r\n\t\t\t\twidth:\"100%\", \r\n\t\t\t\theight: \"100%\", \r\n\t\t\t\tmargin:0, \r\n\t\t\t\tpadding:\"none\", \r\n\t\t\t\tleft:0, top:0, \r\n\t\t\t\tbackgroundSize:\"cover\", \r\n\t\t\t\topacity: index ? 0 : 1, \r\n\t\t\t\ttransition: `opacity ${transition}s`\r\n\t\t\t};\r\n\r\n\t\t\tconst subStyle = {\r\n\t\t\t\topacity: index ? 0 : 1, \r\n\t\t\t\ttransition: `opacity ${transition}s`, \r\n\t\t\t\tpointerEvents: index ? \"none\" : \"auto\"\r\n\t\t\t}\r\n\r\n\t\t\tsubRefs[index] = React.createRef();\r\n\t\t\tbgRefs[index] = React.createRef();\r\n\r\n\t\t\treturn (\r\n\t\t\t\t<React.Fragment key={index}>\r\n\t\t\t\t\t<div ref={bgRefs[index]}><Img fluid={data.childImageSharp.fluid} style={{...backgroundStyle, ...style}} {...imageProps}/></div>\r\n\t\t\t\t\t<div ref={subRefs[index]} style={subStyle}>{React.Children.toArray(children)[index]}</div>\r\n\t\t\t\t</React.Fragment>\r\n\t\t\t);\r\n\t\t} \r\n\t);\r\n\t\t\r\n\tconst [timeoutHandle, setTimeoutHandle] = useState(0);\r\n\tconst timeoutHandleRef = useRef(timeoutHandle);\r\n\ttimeoutHandleRef.current = timeoutHandle;\r\n\tconst [index, setIndex] = useState(0);\r\n\tconst indexRef = useRef(index);\r\n\tindexRef.current = index;\r\n\t\r\n\tif (callbacks) callbacks.getCount = () => imgs.length;\r\n\r\n\tconst clearAndSetTimeoutHandle = (newTimeoutHandle) => {\r\n\t\tclearTimeout(timeoutHandleRef.current);\r\n\t\tsetTimeoutHandle(newTimeoutHandle);\r\n\t}\r\n\r\n\tconst initEffect = () => {\r\n\t\tbgRefs.forEach((bgRef) => {\r\n\t\t\tbgWrappers.push(bgRef.current.firstElementChild);\t\t\t\r\n\t\t});\r\n\r\n\t\tsubRefs.forEach((subRef) =>{\r\n\t\t\tsubWrappers.push(subRef.current);\r\n\t\t})\r\n\t\t\r\n\t\tconst length = bgWrappers.length;\r\n\r\n\t\tconst changeIndex = function (newIndex) {\r\n\t\t\tconst index = indexRef.current;\r\n\t\t\tclearTimeout(timeoutHandleRef.current);\r\n\t\t\t\t\t\r\n\t\t\tbgWrappers[index].style.opacity = 0;\r\n\t\t\tbgWrappers[(newIndex) % length].style.opacity = 1;\r\n\r\n\t\t\tsubWrappers[index].style.opacity = 0;\r\n\t\t\tsubWrappers[index].style.pointerEvents = \"none\";\r\n\t\t\t\r\n\t\t\tsubWrappers[(newIndex) % length].style.opacity = 1;\r\n\t\t\tsubWrappers[(newIndex) % length].style.pointerEvents = \"auto\";\t\t\t\t\t\r\n\t\r\n\t\t\tif(callbacks && callbacks.onChange){\r\n\t\t\t\tcallbacks.onChange(index, newIndex % length);\r\n\t\t\t}\r\n\t\t\tsetIndex((newIndex) % length);\r\n\t\t\tclearAndSetTimeoutHandle(setTimeout(callback, duration * 1000));        \r\n\t\t}\r\n\r\n\t\tconst callback = function(){\r\n\t\t\tconst index = indexRef.current;\r\n\t\t\tchangeIndex(index + 1)\r\n\t\t}\r\n\r\n\t\tclearAndSetTimeoutHandle(setTimeout(callback, initDelay * 1000));\r\n \r\n\t\tif (callbacks){     \r\n\t\t\tcallbacks.atIndex = changeIndex\r\n\r\n\t\t\tcallbacks.next = () => callbacks.atIndex((indexRef.current + 1) % length);\r\n\t\t\tcallbacks.prev = () => callbacks.atIndex((indexRef.current + length - 1) % length);\r\n\t\t}\r\n\t\t\r\n\t\treturn () => {\r\n\t\t\tclearTimeout(timeoutHandleRef.current);\r\n\t\t}\r\n\t}\r\n\t \r\n\t// Runs once after DOM is loaded; effectively `componentDidMount`\t\r\n\tuseEffect(initEffect, []);\r\n\t\r\n\treturn <React.Fragment>{imgs}</React.Fragment>\t\r\n}\r\n\r\nBackgroundSlider.defaultProps = {\r\n\timages: null,\r\n\tduration: 5,\r\n\ttransition: 2,\r\n\tinitDelay: 5,\r\n}\r\n\r\nBackgroundSlider.propTypes = {\r\n\tquery: PropTypes.object.isRequired,\r\n\timages: PropTypes.arrayOf(PropTypes.string),\r\n\tduration: PropTypes.number,\r\n\ttransition: PropTypes.number,\r\n\tinitDelay: PropTypes.number,\r\n}\r\n\r\nexport default BackgroundSlider\r\n\r\nexport const Pagination = ({callbacks}) => {\r\n\tlet buttonRefs = [];\r\n\r\n\tuseEffect(()=>{\r\n\t\tcallbacks.onChange = (prevIndex, newIndex) => { \r\n\t\t\tbuttonRefs[prevIndex].current.style.color = 'silver'; \r\n\t\t\tbuttonRefs[prevIndex].current.style.transform = 'scale(1.0,1.0)'; \r\n\t\t\tbuttonRefs[newIndex].current.style.color = 'white'; \r\n\t\t\tbuttonRefs[newIndex].current.style.transform=\"scale(1.2, 1.2)\";\r\n\t\t};\t\r\n\t},[]);\r\n\r\n\treturn(\r\n\t\t<React.Fragment>\r\n\t\t\t{Array.from(Array(callbacks.getCount()).keys()).map ((index) =>\r\n\t\t\t\t<span role='button' ref={buttonRefs[index] = React.createRef()} \r\n\t\t\t\tkey={index}\r\n\t\t\t\tstyle={{\r\n\t\t\t\t\tuserSelect: 'none', \r\n\t\t\t\t\tcolor: index === 0 ? 'white' : 'silver', \r\n\t\t\t\t\tfontSize: '4em', \r\n\t\t\t\t\tcursor: 'pointer', \r\n\t\t\t\t\tdisplay: 'inline-block', \r\n\t\t\t\t\ttransform: index === 0 ? 'scale(1.2,1.2)' : 'scale(1.0)'\r\n\t\t\t\t}} \r\n\t\t\t\tonClick={() => callbacks.atIndex(index)}>&middot;</span>\r\n\t\t\t)}\r\n\t\t</React.Fragment>\r\n\t)\r\n}\r\n"],"names":["BackgroundSlider","callbacks","images","duration","transition","initDelay","query","children","gatsbyImageProps","nodes","bgRefs","subRefs","bgWrappers","subWrappers","style","imageProps","safePush","data","push","length","image","backgrounds","find","node","relativePath","imgs","map","index","backgroundStyle","top","subStyle","React","createRef","childImageSharp","fluid","Children","toArray","useState","timeoutHandle","setTimeoutHandle","timeoutHandleRef","useRef","current","setIndex","indexRef","getCount","clearAndSetTimeoutHandle","newTimeoutHandle","initEffect","forEach","bgRef","firstElementChild","subRef","changeIndex","newIndex","opacity","pointerEvents","onChange","setTimeout","callback","atIndex","next","prev","defaultProps","propTypes","PropTypes","object","isRequired","arrayOf","string","number","Pagination","buttonRefs","prevIndex","color","transform","from","Array","keys"],"mappings":"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"}